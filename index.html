<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Weather Station â€” Pro Dashboard</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
html{height:100%}
:root{
  --bg1:#04000c;
  --bg2:#1a0437;
  --card:#0a1a24;
  --accent:#00e4ff;
  --text:#ffffff;
}
.light{
  --bg1:#f1f4ff;
  --bg2:#ffffff;
  --card:#ffffff;
  --accent:#005eff;
  --text:#111;
}
body{
  margin:0;
  font-family:Segoe UI,Roboto,sans-serif;
  background:radial-gradient(circle at top,var(--bg2),var(--bg1));
  color:var(--text);
}
header{
  text-align:center;
  padding:20px;
  font-size:32px;
  font-weight:900;
}
.controls{text-align:center;margin-bottom:16px}
button{
  background:var(--accent);
  border:none;
  padding:10px 18px;
  border-radius:14px;
  margin:6px;
  font-weight:700;
  cursor:pointer;
  box-shadow:0 0 18px #00e4ff66;
}
.grid{
  display:grid;
  grid-template-columns:300px 1fr 320px;
  gap:28px;
  padding:24px;
}
.card{
  background:linear-gradient(145deg,#081821,#0c2a3a);
  border-radius:22px;
  padding:18px;
  box-shadow:0 0 35px #0008;
}
.card h3{
  margin:0 0 10px;
  color:var(--accent);
}
.value{
  font-size:36px;
  font-weight:900;
}

/* LEFT */
.left{display:flex;flex-direction:column;gap:22px}
.left .card{min-height:110px}

/* CENTER */
.chart-card{height:620px}
canvas{width:100%!important;height:94%!important}

/* RIGHT */
.right{display:flex;flex-direction:column;gap:22px}

/* AQI COLORS */
.aqi-good{color:#7dff9a}
.aqi-poor{color:#ffd166}
.aqi-bad{color:#ff4d6d}

/* ===== OLD MODERN NEON PRESSURE RING ===== */
.gauge-wrap{
  position:relative;
  width:240px;
  height:240px;
  margin:auto;
}
.gauge svg{
  width:100%;
  height:100%;
  transform:rotate(-90deg);
}
.ring-bg{
  fill:none;
  stroke:#0b3c4a;
  stroke-width:20;
}
.ring-fg{
  fill:none;
  stroke:#00e4ff;
  stroke-width:20;
  stroke-linecap:round;
  stroke-dasharray:565;
  stroke-dashoffset:565;
  transition:stroke-dashoffset .6s ease;
  filter:
    drop-shadow(0 0 8px #00e4ff)
    drop-shadow(0 0 18px #00e4ff)
    drop-shadow(0 0 35px #00e4ff);
}
.gauge-center{
  position:absolute;
  inset:0;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
}
.gauge-center .big{
  font-size:28px;
  font-weight:900;
}
.gauge-center small{opacity:.8}

/* WEATHER */
.weather{
  font-size:30px;
  font-weight:900;
  text-align:center;
}

/* TOAST */
#toast{
  position:fixed;
  bottom:24px;
  right:24px;
  background:linear-gradient(145deg,#0c2c3d,#0f5c78);
  padding:14px 22px;
  border-radius:18px;
  font-weight:800;
  box-shadow:0 0 30px #00e4ffaa;
  display:none;
}
</style>
</head>

<body>
<header>Weather Station â€” Pro Dashboard</header>

<div class="controls">
  <button onclick="connect()">ğŸ”Œ Connect Arduino</button>
  <button onclick="simulate()">âš¡ Simulate Data</button>
  <button onclick="exportCSV()">ğŸ“¤ Export CSV</button>
  <button onclick="clearData()">ğŸ—‘ Clear Data</button>
  <button onclick="toggleMode()">ğŸŒ“ Dark/Light Mode</button>
</div>

<div class="grid">

  <!-- LEFT -->
  <div class="left">
    <div class="card"><h3>ğŸŒ¡ï¸ Temperature</h3><div class="value" id="temp">-- Â°C</div></div>
    <div class="card"><h3>ğŸ’§ Humidity</h3><div class="value" id="hum">-- %</div></div>
    <div class="card"><h3>ğŸ—» Altitude</h3><div class="value" id="alt">-- m</div></div>
    <div class="card"><h3>ğŸŒ§ Rain</h3><div class="value" id="rain">--</div></div>
  </div>

  <!-- CENTER -->
  <div class="card chart-card">
    <h3>ğŸ“Š Sensor Graphs</h3>
    <canvas id="chart"></canvas>
  </div>

  <!-- RIGHT -->
  <div class="right">

    <div class="card">
      <h3>ğŸ« AQI</h3>
      <div class="value" id="aqiVal">--</div>
      <div id="aqiText">--</div>
    </div>

    <div class="card">
      <h3>ğŸ”® Atmospheric Pressure</h3>
      <div class="gauge-wrap gauge">
        <svg viewBox="0 0 200 200">
          <circle cx="100" cy="100" r="90" class="ring-bg"/>
          <circle cx="100" cy="100" r="90" class="ring-fg" id="ring"/>
        </svg>
        <div class="gauge-center">
          <div class="big" id="press">-- hPa</div>
          <small>Neon Pressure Gauge</small>
        </div>
      </div>
    </div>

    <div class="card">
      <h3>ğŸŒ¦ Weather Condition â›…</h3>
      <div class="weather" id="weather">--</div>
    </div>

  </div>
</div>

<div id="toast"></div>

<script>
let chart;
const ctx=document.getElementById("chart");

chart=new Chart(ctx,{
  type:"line",
  data:{labels:[],datasets:[
    {label:"Temp",borderColor:"#00e4ff",data:[]},
    {label:"Humidity",borderColor:"#ff4d9a",data:[]},
    {label:"Pressure",borderColor:"#ffd166",data:[]},
    {label:"AQI",borderColor:"#7df2a6",data:[]}
  ]},
  options:{responsive:true,maintainAspectRatio:false}
});

function toast(msg){
  const t=document.getElementById("toast");
  t.innerText=msg;
  t.style.display="block";
  setTimeout(()=>t.style.display="none",3000);
}

/* ===== PARSE YOUR ARDUINO FORMAT ===== */
function parseLine(line){
  const p=line.trim().split(",");
  if(p.length<8) return;

  let dhtT=parseFloat(p[0]);
  let dhtH=parseFloat(p[1]);
  let bmpT=parseFloat(p[2]);
  let pressure=parseFloat(p[3]);
  let altitude=parseFloat(p[4]);
  let rainStatus=p[5];
  let aqi=parseInt(p[7]);

  let tempVal=dhtT!==-1?dhtT:bmpT;
  if(dhtT===-1) toast("âš  DHT11 failed â†’ BMP280 temperature used");

  update(tempVal,dhtH,pressure,aqi,rainStatus,altitude);
}

function update(t,h,p,aqi,r,a){
  temp.innerText=t.toFixed(1)+" Â°C";
  hum.innerText=h===-1?"Sensor Missing":h.toFixed(1)+" %";
  alt.innerText=a.toFixed(1)+" m";
  rain.innerText=r;
  press.innerText=p.toFixed(1)+" hPa";

  aqiVal.innerText=aqi;
  if(aqi<50){aqiVal.className="value aqi-good";aqiText.innerText="Good"}
  else if(aqi<100){aqiVal.className="value aqi-poor";aqiText.innerText="Moderate"}
  else{aqiVal.className="value aqi-bad";aqiText.innerText="Hazardous"}

  weather.innerText=
    aqi<50?"â˜€ï¸ Clear":
    aqi<100?"ğŸŒ¤ Moderate":"â˜ ï¸ Hazardous";

  const pct=Math.min(1,Math.max(0,(p-900)/200));
  ring.style.strokeDashoffset=565*(1-pct);

  chart.data.labels.push("");
  chart.data.datasets[0].data.push(t);
  chart.data.datasets[1].data.push(h);
  chart.data.datasets[2].data.push(p);
  chart.data.datasets[3].data.push(aqi);

  if(chart.data.labels.length>40){
    chart.data.labels.shift();
    chart.data.datasets.forEach(d=>d.data.shift());
  }
  chart.update();
}

function clearData(){
  chart.data.labels=[];
  chart.data.datasets.forEach(d=>d.data=[]);
  chart.update();

  temp.innerText="-- Â°C";
  hum.innerText="-- %";
  alt.innerText="-- m";
  rain.innerText="--";
  press.innerText="-- hPa";
  aqiVal.innerText="--";
  aqiText.innerText="--";
  weather.innerText="--";
  ring.style.strokeDashoffset=565;

  toast("ğŸ—‘ Data cleared");
}

async function connect(){
  if(!("serial" in navigator)){toast("Web Serial not supported");return;}
  const port=await navigator.serial.requestPort();
  await port.open({baudRate:9600});
  toast("Arduino connected âœ…");

  const decoder=new TextDecoderStream();
  port.readable.pipeTo(decoder.writable);
  const reader=decoder.readable.getReader();
  let buf="";
  while(true){
    const {value,done}=await reader.read();
    if(done)break;
    buf+=value;
    let lines=buf.split("\n");
    buf=lines.pop();
    lines.forEach(parseLine);
  }
}

function simulate(){
  parseLine("25,60,26,1015,35,No Rain â˜€ï¸,800,42");
}

function exportCSV(){
  let csv="Temp,Hum,Pressure,AQI\n";
  chart.data.datasets[0].data.forEach((_,i)=>{
    csv+=chart.data.datasets.map(d=>d.data[i]).join(",")+"\n";
  });
  let a=document.createElement("a");
  a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
  a.download="weather.csv";
  a.click();
}

function toggleMode(){
  document.body.classList.toggle("light");
}
</script>
</body>
</html>
